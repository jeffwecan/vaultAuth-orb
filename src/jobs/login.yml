description: >
  Login to Vault using the CircleCI auth method.

docker:
  - image: 'cimg/base:stable'
resource_class: small

parameters:
  vault-addr:
    description: Vault address
    type: string
  path:
    default: "circleci"
    description: Path for the auth method, leave blank to use default path based on chosen method
    type: string

steps:
  - install
  - print-nonce:
      vault-addr: << parameters.vault-addr >>
      path: << parameters.path >>
  - login:
      vault-addr: << parameters.vault-addr >>
      path: << parameters.path >>

  # Persist the specified paths (workspace/echo-output) into the workspace for use in downstream job.
  - persist_to_workspace:
      # Must be an absolute path, or relative path from working_directory. This is a directory on the container which is
      # taken to be the root directory of the workspace.
      root: ~
      # Must be relative path from root
      paths:
        - .vault-token
